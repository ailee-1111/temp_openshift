1. htpasswd로 사용자와 비밀번호 생성하기
사전 조건
- OpenShift CLI(oc)를 사용할 수 있는 권한.
- htpasswd 유틸리티가 설치되어 있어야 합니다.
- RHEL 계열에서는 다음 명령어로 설치할 수 있습니다:

```bash
sudo dnf install httpd-tools
```

명령어
(1) 새로운 사용자와 비밀번호 추가:

```bash
htpasswd -c ~/htpasswd <username>
```
- -c 옵션은 새로운 파일을 생성하며, 기존 파일을 덮어씁니다.
- 예:

```bash
htpasswd -c ~/htpasswd testuser
```
(2) 추가 사용자를 생성할 경우 -c 없이 실행:

```bash
htpasswd ~/htpasswd <username>
```

(3) 생성된 파일 확인:

```bash
cat ~/htpasswd
```

2. OpenShift OAuth에서 htpasswd 인증을 설정하거나 변경
(1)OAuth CRD 확인 현재 OAuth 설정을 확인합니다:

```bash
oc get oauth cluster -o yaml
```

(2) htpasswd 인증으로 업데이트 새로 생성된 htpasswd 파일을 Secret으로 OpenShift에 추가합니다.

```bash
oc create secret generic htpasswd-secret --from-file=htpasswd=~/htpasswd -n openshift-config
```

(3) OAuth 설정 수정 OpenShift OAuth 설정을 수정하여 htpasswd를 활성화합니다.

```bash
oc edit oauth cluster
```

아래와 같이 YAML을 수정합니다:

```bash
spec:
  identityProviders:
  - name: my_htpasswd_provider
    mappingMethod: claim
    type: HTPasswd
    htpasswd:
      fileData:
        name: htpasswd-secret
```

(4)변경사항 적용 및 확인: OAuth 설정이 변경되면 OpenShift의 인증 서비스가 자동으로 갱신됩니다.

```bash
oc get authentication
```

3. 기존 htpasswd 사용자 삭제 또는 비밀번호 변경
(1) 사용자 삭제 기존 사용자 삭제는 htpasswd 파일에서 해당 사용자 라인을 제거하여 처리할 수 있습니다:

```bash
htpasswd -D ~/htpasswd <username>
```

(2)비밀번호 변경 기존 사용자 비밀번호를 변경하려면 -c 없이 동일한 명령을 사용합니다:

```bash
htpasswd ~/htpasswd <username>
```

(3)새 Secret으로 갱신 Secret에 새로 수정된 htpasswd 파일을 적용합니다:

```bash
oc delete secret htpasswd-secret -n openshift-config
```

```bash
oc create secret generic htpasswd-secret --from-file=htpasswd=~/htpasswd -n openshift-config
```

4. 기존 OAuth 설정에서 htpasswd 인증 삭제
(1) oc edit oauth cluster 명령으로 OAuth 설정을 수정합니다:
```bash
oc edit oauth cluster
```

(2)identityProviders에서 htpasswd 섹션을 제거합니다:

```bash
spec:
  identityProviders: []
```

(3)변경사항 확인:

```bash
oc get oauth cluster -o yaml
```
